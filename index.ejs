<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AccountSupervisor - WebInterface</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      html, body {
        background: url(bg.jpg) center no-repeat;
		background-size: cover;
      }
	  html,body{
	  height:100%;
	}
	body{
	  padding:0;
	  margin:0;
	  color: #ccc;
	  font-family: 'Ubuntu', sans-serif;
	}
	.container{
	  height:100%;
	  display:flex;
	  flex-direction: column;
	  align-items:center;
	  justify-content:center;
	}
	.s{
	  display: block;
	  margin:1rem;
	  max-width:350px;
	  border-radius: 8px;
	  width:50%;
	  background: #18191c;
	}
	.main {padding: 10px;}
	@media(max-width:34em){
	  .s{
		min-width:150px;
		width:auto;
	  }
	}
	select {
		display: none !important;
	}

	.dropdown-select {
		background-image: linear-gradient(to bottom, rgba(24, 25, 28, 0.25) 0%, rgba(24, 25, 28, 0) 100%);
		background-repeat: repeat-x;
		background-color: #28292E;
		border-radius: 6px;
		border: solid 1px #3F4248;
		box-shadow: 0px 2px 5px 0px rgba(24, 25, 28, 0.5);
		box-sizing: border-box;
		cursor: pointer;
		display: block;
		float: left;
		font-size: 14px;
		font-weight: normal;
		height: 42px;
		line-height: 40px;
		outline: none;
		padding-left: 18px;
		padding-right: 30px;
		position: relative;
		text-align: left !important;
		transition: all 0.2s ease-in-out;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
		white-space: nowrap;
		width: auto;

	}

	.dropdown-select:focus {
		background-color: #2F3137;
	}

	.dropdown-select:hover {
		background-color: #212226;
	}

	.dropdown-select:active,
	.dropdown-select.open {
		background-color: #2F3137 !important;
		border-color: #222;
		box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05) inset;
	}

	.dropdown-select:after {
		height: 0;
		width: 0;
		border-left: 4px solid transparent;
		border-right: 4px solid transparent;
		border-top: 4px solid #777;
		-webkit-transform: origin(50% 20%);
		transform: origin(50% 20%);
		transition: all 0.125s ease-in-out;
		content: '';
		display: block;
		margin-top: -2px;
		pointer-events: none;
		position: absolute;
		right: 10px;
		top: 50%;
	}

	.dropdown-select.open:after {
		-webkit-transform: rotate(-180deg);
		transform: rotate(-180deg);
	}

	.dropdown-select.open .list {
		-webkit-transform: scale(1);
		transform: scale(1);
		opacity: 1;
		pointer-events: auto;
	}

	.dropdown-select.open .option {
		cursor: pointer;
	}

	.dropdown-select.wide {
		width: 100%;
	}

	.dropdown-select.wide .list {
		left: 0 !important;
		right: 0 !important;
	}

	.dropdown-select .list {
		box-sizing: border-box;
		transition: all 0.15s cubic-bezier(0.25, 0, 0.25, 1.75), opacity 0.1s linear;
		-webkit-transform: scale(0.75);
		transform: scale(0.75);
		-webkit-transform-origin: 50% 0;
		transform-origin: 50% 0;
		box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.09);
		background-color: #2F3137;
		border-radius: 6px;
		margin-top: 4px;
		padding: 3px 0;
		opacity: 0;
		overflow: hidden;
		pointer-events: none;
		position: absolute;
		top: 100%;
		left: 0;
		z-index: 999;
		max-height: 250px;
		overflow: auto;
		border: 1px solid #222;
	}

	.dropdown-select .list:hover .option:not(:hover) {
		background-color: transparent !important;
	}
	.dropdown-select .dd-search{
	  overflow:hidden;
	  display:flex;
	  align-items:center;
	  justify-content:center;
	  margin:0.5rem;
	}

	.dropdown-select .dd-searchbox{
	  width:90%;
	  padding:0.5rem;
	  border:1px solid #999;
	  border-color:#999;
	  border-radius:4px;
	  outline:none;
	}
	.dropdown-select .dd-searchbox:focus{
	  border-color:#12CBC4;
	}

	.dropdown-select .list ul {
		padding: 0;
	}

	.dropdown-select .option {
		cursor: default;
		font-weight: 400;
		line-height: 40px;
		outline: none;
		padding-left: 18px;
		padding-right: 29px;
		text-align: left;
		transition: all 0.2s;
		list-style: none;
	}

	.dropdown-select .option:hover,
	.dropdown-select .option:focus {
		background-color: #25272B !important;
	}

	.dropdown-select .option.selected {
		font-weight: 600;
		color: #ccc;
	}

	.dropdown-select .option.selected:focus {
		background: #3F4248;
	}

	.dropdown-select a {
		color: #ccc;
		text-decoration: none;
		transition: all 0.2s ease-in-out;
	}

	.dropdown-select a:hover {
		color: #ccc;
	}
	
	.icon {
		position: relative;
		display: inline-block;
		width:32px;
		height:32px;
		background: #545762;
		border-radius: 50%;
		margin: auto 10px auto 0;
		vertical-align: middle;
		overflow: hidden;
	}
	.icon .im {
		position: absolute;
		width:100%;
		height:100%;
	}
	
	.footer {
		position: relative;
		width:100%;
		padding: 10px 0;
		background: #2f3136;
		border-radius: 0 0 8px 8px;
		display: flex;
		justify-content: flex-end;
		align-items: center;
	}
	
	.btn {
		color: #fff;
		background-color: #7289da;
		padding: 10px;
		margin: 0 10px;
		display: -webkit-box;
		display: -ms-flexbox;
		display: flex;
		-webkit-box-pack: center;
		-ms-flex-pack: center;
		justify-content: center;
		-webkit-box-align: center;
		-ms-flex-align: center;
		align-items: center;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		border: none;
		border-radius: 3px;
		font-size: 14px;
		font-weight: 500;
		line-height: 16px;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
	}

    </style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  </head>
  <body>
	
	<div class="container">
	  <div class="s">
	  <div class="main" id="serverslist">
		<h2>Sélectionner le serveur:<h2>
		<select id="select-servers"></select>
	  </div>
	  <div style="height:100px;"></div>
	  <div class="footer">
		<button class="btn" id="go">Accéder</button>
	  </div>
	  </div>
	</div>
	
    <script type="text/javascript">
      var user = JSON.parse('<%- JSON.stringify(user).replace(/'/g,'\\\'') %>');
	  var botguilds = JSON.parse('<%- JSON.stringify(guilds).replace(/'/g,'\\\'') %>');
	  //var user = JSON.parse('{"id":"627961847248715777","username":"FlammrockTester","avatar":null,"discriminator":"1036","locale":"fr","mfa_enabled":false,"flags":0,"guilds":[{"id":"691097393059463239","name":"Roblox Dev","icon":"a69b7fac332a49ff701caa405441390c","owner":false,"permissions":133693249,"features":[]},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee","owner":false,"permissions":104324673,"features":[]}]}');
	  //var botguilds = JSON.parse('[{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"},{"id":"693824505826639952","name":"AccountSupervisor","icon":"014b876d9212dec84f4a053a79fefbee"}]');
	  
	  console.log(user);
	  console.log(botguilds);
	  var communs = "";
	  var index = 1;
	  for (var i = 0; i < botguilds.length; i++) {
		for (var j = 0; j < user.guilds.length; j++) {
			if (botguilds[i].id==user.guilds[j].id) {
				if (botguilds[i].icon!=null) {
					communs+='<option data-id="'+botguilds[i].id+'" data-display-icon="https://cdn.discordapp.com/icons/'+botguilds[i].id+'/'+botguilds[i].icon+'.png" value="'+index+'">'+botguilds[i].name+'</option>';
				} else {
					communs+='<option data-id="'+botguilds[i].id+'" value="'+index+'">'+botguilds[i].name+'</option>';
				}
				
				index++;
			}
		}
	  }
	  document.getElementById('select-servers').innerHTML = communs;
	  
	  document.getElementById('go').onclick = function() {
	    var option = $('#serverslist').find('.option.selected')[0];
		var id = $(option).data('id');
		document.location = document.location.origin + '/' + id;
	  }
	  
	  function create_custom_dropdowns() {
		$('select').each(function (i, select) {
			if (!$(this).next().hasClass('dropdown-select')) {
				$(this).after('<div class="dropdown-select wide ' + ($(this).attr('class') || '') + '" tabindex="0"><span class="current"></span><div class="list"><ul></ul></div></div>');
				var dropdown = $(this).next();
				var options = $(select).find('option');
				var selected = $(this).find('option:selected');
				dropdown.find('.current').html(selected.data('display-text') || selected.text());
				options.each(function (j, o) {
					var display = $(o).data('display-text') || '';
					var icon = $(o).data('display-icon') || '';
					var id = $(o).data('id') || '';
					if (icon != '') {
						icon = '<div class="icon"><div class="im" style="background:url('+icon+') center no-repeat;background-size:cover;"></div></div>';
					} else {
						icon = '<div class="icon"></div>';
					}
					dropdown.find('ul').append('<li class="option ' + ($(o).is(':selected') ? 'selected' : '') + '" data-id="'+id+'" data-value="' + $(o).val() + '" data-display-text="' + display + '">' + icon + $(o).html() + '</li>');
				});
			}
		});

		$('.dropdown-select ul').before('<div class="dd-search"><input id="txtSearchValue" autocomplete="off" onkeyup="filter()" class="dd-searchbox" type="text"></div>');
	}

	// Event listeners

	// Open/close
	$(document).on('click', '.dropdown-select', function (event) {
		if($(event.target).hasClass('dd-searchbox')){
			return;
		}
		$('.dropdown-select').not($(this)).removeClass('open');
		$(this).toggleClass('open');
		if ($(this).hasClass('open')) {
			$(this).find('.option').attr('tabindex', 0);
			$(this).find('.selected').focus();
		} else {
			$(this).find('.option').removeAttr('tabindex');
			$(this).focus();
		}
	});

	// Close when clicking outside
	$(document).on('click', function (event) {
		if ($(event.target).closest('.dropdown-select').length === 0) {
			$('.dropdown-select').removeClass('open');
			$('.dropdown-select .option').removeAttr('tabindex');
		}
		event.stopPropagation();
	});

	function filter(){
		var valThis = $('#txtSearchValue').val();
		$('.dropdown-select ul > li').each(function(){
		 var text = $(this).text();
			(text.toLowerCase().indexOf(valThis.toLowerCase()) > -1) ? $(this).show() : $(this).hide();         
	   });
	};
	// Search

	// Option click
	$(document).on('click', '.dropdown-select .option', function (event) {
		$(this).closest('.list').find('.selected').removeClass('selected');
		$(this).addClass('selected');
		var text = $(this).data('display-text') || $(this).text();
		$(this).closest('.dropdown-select').find('.current').text(text);
		$(this).closest('.dropdown-select').prev('select').val($(this).data('value')).trigger('change');
	});

	// Keyboard events
	$(document).on('keydown', '.dropdown-select', function (event) {
		var focused_option = $($(this).find('.list .option:focus')[0] || $(this).find('.list .option.selected')[0]);
		// Space or Enter
		//if (event.keyCode == 32 || event.keyCode == 13) {
		if (event.keyCode == 13) {
			if ($(this).hasClass('open')) {
				focused_option.trigger('click');
			} else {
				$(this).trigger('click');
			}
			return false;
			// Down
		} else if (event.keyCode == 40) {
			if (!$(this).hasClass('open')) {
				$(this).trigger('click');
			} else {
				focused_option.next().focus();
			}
			return false;
			// Up
		} else if (event.keyCode == 38) {
			if (!$(this).hasClass('open')) {
				$(this).trigger('click');
			} else {
				var focused_option = $($(this).find('.list .option:focus')[0] || $(this).find('.list .option.selected')[0]);
				focused_option.prev().focus();
			}
			return false;
			// Esc
		} else if (event.keyCode == 27) {
			if ($(this).hasClass('open')) {
				$(this).trigger('click');
			}
			return false;
		}
	});

	$(document).ready(function () {
		create_custom_dropdowns();
	});
    </script>
  </body>
</html>
